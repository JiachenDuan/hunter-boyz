    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#05070f; color:#e6edf3; font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial; touch-action: manipulation; }
    #renderCanvas { width:100%; height:100%; touch-action:none; }
    /* iOS long-press / selection prevention */
    body, #ui, canvas, button, input, select, textarea {
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
      overscroll-behavior: none;
    }
    #ui { position: fixed; inset: 0; pointer-events:none; }
    #hud { position:absolute; top:10px; left:10px; background: rgba(0,0,0,0.35); border:1px solid rgba(255,255,255,0.12); border-radius:12px; padding:10px 12px; pointer-events:auto; max-width: min(72vw, 420px); display:inline-flex; flex-direction:column; gap:8px; }
    #hud input { border-radius:10px; border:1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.06); color:#e6edf3; padding:8px 10px; width: 160px; }
    #hud button { margin-left:6px; border-radius:10px; border:1px solid rgba(255,255,255,0.15); background: rgba(124,92,255,0.9); color:white; padding:8px 10px; }

    /* Compact HUD to avoid overlapping the score box when Settings are closed */
    #hud.hudCompact {
      padding: 8px 10px;
      max-width: none;
      width: fit-content;
      display: inline-flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      backdrop-filter: blur(2px);
    }
    #hud.hudCompact #log { display:none; }
    #hud.hudCompact #settingsPanel { display:none !important; }
    #hud.hudCompact button, #hud.hudCompact input, #hud.hudCompact select { padding: 6px 8px; }
    #hud.hudCompact #settingsBtn { padding: 6px 8px !important; }
    #hud.hudCompact .hudTitle { font-size: 13px; }
    #log { margin-top:8px; font-size:12px; color: rgba(230,237,243,0.75); }

    /* Touch controls */
    .stick { position:absolute; bottom: var(--move-bottom); width:140px; height:140px; border-radius:999px; background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.12); pointer-events:auto; touch-action:none; z-index: 10; }
    #moveStick { left: var(--pad); }
    #lookPad { right: var(--pad); width: calc(var(--btn) * 2.1); height: calc(var(--btn) * 2.1); border-radius: 18px; background: rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.10); }
    .nub { position:absolute; left:50%; top:50%; width:64px; height:64px; margin-left:-32px; margin-top:-32px; border-radius:999px; background: rgba(124,92,255,0.25); border:1px solid rgba(124,92,255,0.55); }
    /* Use CSS variables so controls scale with screen size */
    :root {
      --pad: 18px;
      --btn: 86px;
      --btn-gap: 12px;
      --bottom: calc(20px + env(safe-area-inset-bottom));
      --move-bottom: calc(var(--bottom) + 18px);
    }
    #btnJump, #btnShoot { position:absolute; bottom: var(--bottom); width: var(--btn); height: var(--btn); border-radius: 999px; pointer-events:auto; touch-action:none; border:1px solid rgba(255,255,255,0.14); display:flex; align-items:center; justify-content:center; z-index: 11; }
    #btnShoot { right: calc(var(--pad) + var(--btn) + var(--btn-gap)); background: rgba(255,80,80,0.25); border-color: rgba(255,80,80,0.6); }
    #btnJump { right: calc(var(--pad) + (var(--btn) + var(--btn-gap)) * 2); background: rgba(80,200,255,0.18); border-color: rgba(80,200,255,0.55); }

    #btnReload, #btnScope { display:flex; align-items:center; justify-content:center; }

    .btnLabel {
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      letter-spacing: 0.6px;
      line-height: 1;
      color: rgba(230,237,243,0.92);
      text-shadow: 0 2px 10px rgba(0,0,0,0.65);
      user-select: none;
      -webkit-user-select: none;
      pointer-events: none;
    }
    .btnIcon {
      font-size: 26px;
      line-height: 1;
      opacity: 0.95;
    }
    #btnScope .btnIcon { font-size: 30px; }
    .btnText { display:none; }

    .btnPressed {
      transform: scale(0.94);
      filter: saturate(1.1) brightness(1.2);
      box-shadow: 0 0 0 2px rgba(255,255,255,0.14), 0 8px 20px rgba(0,0,0,0.35);
    }
    #score { position:absolute; top:10px; right:10px; background: rgba(0,0,0,0.35); border:1px solid rgba(255,255,255,0.12); border-radius:12px; padding:10px 12px; pointer-events:none; font-size:12px; min-width: 140px; }

    /* Extra buttons (sprint/reload) sit above jump/shoot */

    /* Weapon picker button */
    #btnWeaponPick {
      position:absolute;
      bottom: calc(var(--bottom) + var(--btn) + 12px);
      right: var(--pad);
      width: var(--btn); height: var(--btn);
      border-radius: 999px;
      pointer-events:auto; touch-action:none;
      border:1px solid rgba(255,200,60,0.55);
      background: rgba(255,200,60,0.15);
      display:flex; align-items:center; justify-content:center;
      z-index: 12;
      transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease;
    }
    #btnWeaponPick:active { transform: scale(0.95); filter: saturate(1.1) brightness(1.15); }
    /* When the weapon modal is open, make the button look "active" */
    #btnWeaponPick.isActive {
      box-shadow: 0 0 0 2px rgba(255,200,60,0.20), 0 0 26px rgba(255,200,60,0.22);
      transform: scale(0.98);
    }
    /* Weapon picker modal */
    #weaponModal {
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.65);
      z-index: 9999;
      pointer-events:auto;
      touch-action: manipulation;
    }
    #weaponModal.open { display:flex; }
    #weaponModalInner {
      width: min(380px, 88vw);
      background: rgba(10,14,26,0.95);
      border:1px solid rgba(255,255,255,0.16);
      border-radius:18px;
      padding: 18px 16px 14px;
      transform: translateY(8px) scale(0.985);
      opacity: 0;
      transition: transform 140ms ease, opacity 140ms ease;
      will-change: transform, opacity;
    }
    #weaponModal.open #weaponModalInner {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    #weaponModalInner .wm-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
    #weaponModalInner .wm-header span { font-weight:900; font-size:17px; }
    #weaponModalInner .wm-close { width:36px; height:36px; border-radius:999px; border:1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.08); color:#e6edf3; font-size:20px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
    #weaponModalInner .wm-grid { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    #weaponModalInner .wm-opt {
      padding: 18px 10px;
      border-radius: 14px;
      border: 2px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      color: #e6edf3;
      font-weight: 800;
      font-size: 16px;
      text-align: center;
      cursor: pointer;
      transition: border-color 120ms, background 120ms;
    }
    #weaponModalInner .wm-opt:active { transform: scale(0.96); }
    #weaponModalInner .wm-opt.selected { border-color: rgba(124,92,255,0.85); background: rgba(124,92,255,0.18); }

    #btnReload, #btnScope { position:absolute; bottom: calc(var(--bottom) + var(--btn) + 12px); width: var(--btn); height: var(--btn); border-radius: 999px; pointer-events:auto; touch-action:none; border:1px solid rgba(255,255,255,0.14); z-index: 12; }
    /* Put scope above the shoot cluster (so it doesn't overlap the look pad) */
    #btnScope { right: calc(var(--pad) + var(--btn) + var(--btn-gap)); }
    /* Reload sits to the left of scope when visible */
    #btnReload { right: calc(var(--pad) + (var(--btn) + var(--btn-gap)) * 2); background: rgba(255,255,255,0.10); border-color: rgba(255,255,255,0.35); }

    /* Responsive tuning */
    @media (max-width: 420px) {
      :root { --pad: 12px; --btn: 72px; --btn-gap: 10px; --bottom: calc(14px + env(safe-area-inset-bottom)); --move-bottom: calc(var(--bottom) + 16px); }
    }
    @media (max-width: 360px) {
      :root { --pad: 10px; --btn: 64px; --btn-gap: 8px; --bottom: calc(12px + env(safe-area-inset-bottom)); --move-bottom: calc(var(--bottom) + 14px); }
    }

    .hudTopRow { display:flex; align-items:center; gap:10px; }
    .hudTitle { font-weight:800; letter-spacing:0.2px; }
    .weaponChip {
      display:none;
      align-items:center;
      gap:6px;
      padding: 4px 8px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      font-size: 12px;
      font-weight: 900;
      letter-spacing: 0.3px;
      opacity: 0.92;
      white-space: nowrap;
      max-width: 34vw;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
    }
    .weaponChip:active {
      transform: scale(0.97);
      filter: saturate(1.1) brightness(1.15);
    }
    /* Show current weapon when HUD is compact (settings hidden) */
    #hud.hudCompact .weaponChip { display:inline-flex; }
    .connWrap {
      display:flex;
      align-items:center;
      gap:6px;
      margin-left: 2px;
    }
    @keyframes connPulse {
      0% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.18); opacity: 1; }
      100% { transform: scale(1); opacity: 0.9; }
    }
    /* When reconnecting, pulse the dot to make it more noticeable */
    .connWrap.isConnecting #connDot {
      animation: connPulse 0.9s ease-in-out infinite;
    }
    #connDot {
      width:10px;
      height:10px;
      border-radius:999px;
      background: rgba(255,80,80,0.95);
      box-shadow: 0 0 0 2px rgba(0,0,0,0.25);
      flex: 0 0 auto;
    }
    .connText {
      display:none;
      font-size: 11px;
      font-weight: 900;
      letter-spacing: 0.6px;
      opacity: 0.75;
    }
    /* Show connection text only when HUD is compact */
    #hud.hudCompact .connText { display:block; }
    #settingsBtn {
      margin-left:auto;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.08);
      color:#e6edf3;
      padding:8px 10px;
      font-weight:800;
    }
    #settingsPanel { margin-top:10px; display:none; }
    .settingsRow { margin-top:8px; display:flex; gap:8px; align-items:center; }
    .settingsRowTight { margin-top:6px; gap:6px; }
    .settingsRowCheckStrong { margin-top:10px; gap:10px; }
    .settingsBlock { margin-top:10px; }
    .settingsBlock input[type="range"] { width:100%; }
    #sensTurn { width:140px; }
    .controlLabel { font-size:12px; opacity:.8; }
    .controlLabelStrong { opacity:.85; font-weight:800; }
    .controlLabelHeavy { opacity:.9; font-weight:900; }
    .controlNote { font-size:12px; opacity:.6; }
    #weapon, #map, #mapLobby { cursor:pointer; padding:8px 10px; }
    .hudActions { margin-top:10px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btnGhost {
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.08);
      color:#e6edf3;
      padding:8px 10px;
      font-weight:700;
    }
    #soundBtn {
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color:#e6edf3;
      padding:8px 10px;
      font-weight:900;
      letter-spacing: 0.3px;
    }
    #soundBtn.soundOn {
      background: rgba(80,255,140,0.12);
      border-color: rgba(80,255,140,0.45);
      color:#d6ffe6;
    }
    #resetLobbyBtn {
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(255,80,80,0.12);
      color:#ffdede;
      padding:8px 10px;
      font-weight:800;
    }
    .hudHint { font-size:12px; opacity:.75; }

    #lobby {
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      pointer-events:auto;
      background: rgba(0,0,0,0.45);
    }
    .lobbyCard {
      width:min(520px, 92vw);
      background: rgba(10,14,26,0.92);
      border:1px solid rgba(255,255,255,0.14);
      border-radius:16px;
      padding:14px;
    }
    .lobbyTitle { font-weight:900; font-size:18px; }
    .lobbyMapRow {
      display:flex;
      gap:8px;
      align-items:center;
      pointer-events:auto;
      background: rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.14);
      border-radius:10px;
      padding:6px 8px;
    }
    #lobbyPlayers { margin-top:10px; font-size:13px; opacity:.9; }
    .lobbyRow { margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    #startBtn {
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.15);
      background: rgba(124,92,255,0.95);
      color:white;
      padding:10px 12px;
      font-weight:800;
    }
    #waitMsg { font-size:12px; opacity:.85; }
    #respawn {
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      pointer-events:none;
      background: rgba(0,0,0,0.25);
    }
    #respawnText {
      background: rgba(10,14,26,0.85);
      border:1px solid rgba(255,255,255,0.14);
      border-radius:16px;
      padding:14px 16px;
      font-weight:900;
    }

    #status {
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:14px;
      width:min(520px, 92vw);
      pointer-events:none;
    }
    .statusRow { display:flex; align-items:center; gap:10px; }
    .hpTrack {
      flex:1;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,0.10);
      border:1px solid rgba(255,255,255,0.14);
      overflow:hidden;
    }
    #hpFill { height:100%; width:100%; background: rgba(80,255,140,0.85); }
    /* Prefer the HP bar over numbers (numbers can be distracting on mobile). */
    #hpText { display:none !important; }
    #ammoText { font-weight:900; font-size:12px; opacity:.85; display:inline-block; transform-origin: 50% 50%; }
    @keyframes ammoPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.06); }
      100% { transform: scale(1); }
    }
    #ammoText.isLow {
      color: rgba(255,120,90,0.98);
      text-shadow: 0 2px 10px rgba(0,0,0,0.55);
      animation: ammoPulse 0.75s ease-in-out infinite;
    }
    #ammoText.isReloading {
      color: rgba(255,240,120,0.95);
    }
    /* Redundant: we already show the weapon via the gun icon. */
    #weaponText { display:none !important; }
    #hitToast {
      margin-top:10px;
      text-align:center;
      font-weight:900;
      font-size:18px;
      opacity:0;
      transition: opacity 120ms ease;
      color: rgba(255,240,120,0.95);
      text-shadow: 0 2px 10px rgba(0,0,0,0.6);
    }
    #hitDetail {
      margin-top:6px;
      text-align:center;
      font-weight:800;
      font-size:13px;
      opacity:0;
      transition: opacity 120ms ease;
      color: rgba(230,237,243,0.9);
    }
    #dmgVignette {
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:94;
      opacity:0;
      transition: opacity 120ms ease;
      background: radial-gradient(circle at center, rgba(0,0,0,0) 55%, rgba(255,0,0,0.22) 100%);
    }
    #killVignette {
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:94;
      opacity:0;
      transition: opacity 90ms ease;
      background: radial-gradient(circle at center, rgba(0,0,0,0) 55%, rgba(80,255,140,0.22) 100%);
      mix-blend-mode: screen;
    }
    #winnerBanner {
      position:fixed;
      top:18%;
      left:50%;
      transform:translateX(-50%);
      padding:12px 14px;
      border-radius:14px;
      background: rgba(0,0,0,0.55);
      border:1px solid rgba(255,255,255,0.18);
      color:#e6edf3;
      font-weight:900;
      font-size:18px;
      letter-spacing:0.4px;
      opacity:0;
      transition: opacity 120ms ease;
      pointer-events:none;
      z-index:95;
    }
    #streakToast {
      position:fixed;
      top:26%;
      left:50%;
      transform:translateX(-50%) scale(0.96);
      padding:10px 14px;
      border-radius:999px;
      background: rgba(255,200,60,0.14);
      border:1px solid rgba(255,200,60,0.35);
      color: rgba(255,245,220,0.98);
      font-weight: 1000;
      font-size: 18px;
      letter-spacing: 0.9px;
      text-shadow: 0 3px 14px rgba(0,0,0,0.6);
      opacity:0;
      transition: opacity 120ms ease, transform 120ms ease;
      pointer-events:none;
      z-index:95;
    }
    #streakToast.show {
      opacity: 1;
      transform:translateX(-50%) scale(1);
    }
    #roundTimer {
      position:fixed;
      top:10px;
      left:50%;
      transform:translateX(-50%);
      z-index:96;
      pointer-events:none;
      font-weight:900;
      font-size:14px;
      letter-spacing:0.6px;
      color: rgba(230,237,243,0.95);
      background: rgba(0,0,0,0.35);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:999px;
      padding:8px 12px;
      min-width:86px;
      text-align:center;
    }
    /* Make lobby state visually distinct so it's obvious the round hasn't started */
    #roundTimer.isLobby {
      background: rgba(80,255,140,0.10);
      border-color: rgba(80,255,140,0.35);
      color: rgba(210,255,230,0.95);
    }
    /* Panic mode: last 10s */
    @keyframes timerPulse {
      0% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.07); }
      100% { transform: translateX(-50%) scale(1); }
    }
    #roundTimer.isEnding {
      background: rgba(255,80,80,0.16);
      border-color: rgba(255,80,80,0.45);
      color: rgba(255,220,220,0.98);
      box-shadow: 0 0 0 2px rgba(255,80,80,0.12), 0 0 28px rgba(255,80,80,0.12);
      animation: timerPulse 0.7s ease-in-out infinite;
    }
    #hitmarker {
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      pointer-events:none;
      opacity:0;
      z-index:90;
    }

    #btnScope {
      background: rgba(0,0,0,0.18);
      border-color: rgba(255,255,255,0.35);
      opacity:0.92;
      z-index:20;
    }
    #btnPickup, #btnDropMinigun, #btnTowerUp, #btnTowerDown {
      position:absolute;
      bottom: calc(var(--bottom) + var(--btn) + 12px);
      left: calc(var(--pad) + var(--btn) + 10px);
      padding:10px 12px;
      border-radius:14px;
      font-weight:900;
      letter-spacing:0.4px;
      pointer-events:auto;
      touch-action:none;
      display:none;
      z-index:60; /* ensure it stays above sticks/pads */
    }
    #btnPickup {
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(255,220,120,0.16);
      color:#fff3c4;
    }
    #btnDropMinigun {
      border:1px solid rgba(255,80,80,0.4);
      background: rgba(255,60,60,0.18);
      color:#ffb3b3;
    }
    #btnTowerUp, #btnTowerDown {
      border:1px solid rgba(120,200,255,0.30);
      background: rgba(120,200,255,0.14);
      color:#d8f1ff;
    }
    #btnTowerDown {
      left: calc(var(--pad) + var(--btn) + 140px);
    }
    #mgHud {
      position:fixed;
      top:46px;
      left:50%;
      transform:translateX(-50%);
      z-index:110;
      display:none;
      gap:8px;
      align-items:center;
      pointer-events:none;
    }
    .mgLabel {
      background:rgba(0,0,0,0.35);
      border:1px solid rgba(255,255,255,0.14);
      border-radius:999px;
      padding:6px 10px;
      font-weight:900;
      font-size:12px;
      color:#e6edf3;
    }
    .mgBar {
      width:80px;
      height:10px;
      background:rgba(255,255,255,0.10);
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.12);
    }
    .mgBarWide { width:140px; }
    .mgBarMed { width:120px; }
    #mgSpin { height:100%; width:0%; background:linear-gradient(90deg, rgba(100,180,255,0.85), rgba(60,140,255,0.85)); }
    #mgAmmo { height:100%; width:100%; background:linear-gradient(90deg, rgba(120,255,160,0.85), rgba(80,220,120,0.85)); }
    #mgHeat { height:100%; width:0%; background:linear-gradient(90deg, rgba(255,200,80,0.85), rgba(255,80,80,0.85)); }

    #scoreModal {
      position:fixed;
      inset:0;
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index:120;
      background: rgba(0,0,0,0.35);
    }
    #scoreModalInner {
      width:min(520px, 96vw);
      max-height:60vh;
      overflow:auto;
      background: rgba(0,0,0,0.78);
      border:1px solid rgba(255,255,255,0.16);
      border-radius:18px;
      padding:14px;
      margin:0 0 14px 0;
    }
    .scoreModalHeader { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .scoreModalTitle { font-weight:900; letter-spacing:0.4px; }
    #btnScoreClose {
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.22);
      background: rgba(0,0,0,0.18);
      color:#e6edf3;
      padding:8px 10px;
      font-weight:900;
    }
    #scoreboardBody { font-size:13px; line-height:1.45; }
